/**
 * kGallery v1.1.1
 *
 * @author Andrew Kondratev [andr@kopolo.ru]
 * @requires jQuery JavaScript Library > v1.3.2
 * includes kSlideshow v1.2.1 and kThumbnailPicker v1.1.1
 *
 * Dual licensed under MIT and GPL 2+ licenses
 * http://kopolo/for-developers/kgallery/_license/
 */
function kSlideshow(new_options){kSlideshowVersion='1.2.1';var defaults={wrapper:'#slideshow-wrapper',dataSource:'data.json',url:undefined,dataType:'json',autoPlay:true,startItem:0,preloadImagesCount:2,nextAttempts:4,interval:2000,fadeDelay:400,itemDivClass:'kSlideshowItemDiv',enableControls:true,enableTitle:true,enableAlt:true,displayEmptyTitle:false,wrapperClass:'kSlideshowWrapper',playToggleClass:'kSlideshowPlayToggle',playClass:'kSlideshowPlay',pauseClass:'kSlideshowPause',nextClass:'kSlideshowNext',prevClass:'kSlideshowPrev',titleClass:'kSlideshowTitle',controlsInactiveClass:'inactive',loadedClass:'loaded',afterInit:function(){},beforeShow:function(itemIndex){},beforeAnimation:function(itemIndex,itemNode){},afterShow:function(){},onLoadingError:function(jqXHR,textStatus,errorThrown){}};var instance={};var options;instance.items=[];instance.wrapper;instance.isPlay=false;instance.playInterval;instance.currentItemIndex;instance.prevButton;instance.playToggleButton;instance.nextButton;function setOptions(new_options){options=jQuery.extend({},defaults,options,new_options);};instance.init=function(){instance.wrapper=jQuery(options.wrapper);instance.wrapper.addClass(options.wrapperClass);instance.isPlay=false;if(instance.items.length<=1){options.enableControls=false;options.autoPlay=false;};if(options.enableControls==true){instance.initControls();};if(options.preloadImagesCount>instance.items.length){options.preloadImagesCount=instance.items.length;};instance.currentItemIndex=options.startItem;instance.showItem(instance.currentItemIndex);instance.preloadItems(instance.currentItemIndex);if(options.autoPlay==true){instance.play();}else{if(options.enableControls==true){instance.playToggleButton.addClass(options.playClass);};instance.preloadItemsPrev(instance.currentItemIndex);};};instance.initControls=function(){options.enableControls=true;if(!instance.prevButton){instance.prevButton=jQuery('<div class="'+options.prevClass+'"></div>').appendTo(instance.wrapper);};instance.prevButton.click(function(){instance.prev();});if(!instance.playToggleButton){instance.playToggleButton=jQuery('<div class="'+options.playToggleClass+'"></div>').appendTo(instance.wrapper);};instance.playToggleButton.click(function(){instance.playToggle();});if(!instance.nextButton){instance.nextButton=jQuery('<div class="'+options.nextClass+'"></div>').appendTo(instance.wrapper);};instance.nextButton.click(function(){instance.next();});};instance.addItem=function(itemIndex){var item=instance.items[itemIndex];var img=new Image();img.src=item.large;$(img).load(function(){instance.items[itemIndex].loaded=true;$(instance.items[itemIndex].node).addClass(options.loadedClass);});var title='';if(options.enableTitle==true){if(item.title!=undefined){title='<div class="'+options.titleClass+'">'+item.title+'</div>';}else if(options.displayEmptyTitle==true){title='<div class="'+options.titleClass+'"></div>';}}
if(options.enableAlt==true){var alt=instance.stripTags(item.title);}else{var alt='';}
var newNode=jQuery('<div class="'+options.itemDivClass+'" style="display: none;"><img src="'+item.large+'" alt="'+alt+'" title="'+alt+'" class="" />'+title+'</div>').appendTo(instance.wrapper);instance.items[itemIndex].node=newNode;return newNode;};instance.preloadItems=function(){for(var relativePreloadIndex=1;relativePreloadIndex<=options.preloadImagesCount;relativePreloadIndex++){var preloadIndex=instance.currentItemIndex+relativePreloadIndex;if(preloadIndex>=instance.items.length){preloadIndex-=instance.items.length;};if(instance.items[preloadIndex]&&!instance.items[preloadIndex].node){instance.addItem(preloadIndex);};};};instance.preloadItemsPrev=function(){for(var relativePreloadIndex=1;relativePreloadIndex<=options.preloadImagesCount;relativePreloadIndex++){var preloadIndex=instance.currentItemIndex-relativePreloadIndex;if(preloadIndex<0){preloadIndex+=instance.items.length;};if(instance.items[preloadIndex]&&!instance.items[preloadIndex].node){instance.addItem(preloadIndex);};};};instance.play=function(){clearInterval(instance.playInterval);instance.playInterval=setInterval(function(){instance.next(true,true);},options.interval);instance.isPlay=true;if(options.enableControls==true){instance.playToggleButton.addClass(options.pauseClass);instance.playToggleButton.removeClass(options.playClass);};};instance.playToggle=function(){if(instance.isPlay==false){instance.play();return'play';}else if(instance.isPlay==true){instance.stop();return'stop';}else{alert('Error: wrong play status in .playToggle()');};};instance.stop=function(){clearInterval(instance.playInterval);instance.isPlay=false;if(options.enableControls==true){instance.playToggleButton.addClass(options.playClass);instance.playToggleButton.removeClass(options.pauseClass);};instance.preloadItemsPrev(instance.currentItemIndex);};instance.next=function(checkIfLoaded,doNotClearPlaybackInterval){var nextItemIndex=instance.currentItemIndex+1;if(nextItemIndex>=instance.items.length){nextItemIndex=0;};if(checkIfLoaded==true&&instance.items[instance.currentItemIndex].nextAttempts==undefined){instance.items[instance.currentItemIndex].nextAttempts=1;}
if(checkIfLoaded!=true||instance.items[instance.currentItemIndex].nextAttempts>options.nextAttempts||(checkIfLoaded==true&&instance.items[instance.currentItemIndex].loaded==true)){instance.showItem(nextItemIndex,true,doNotClearPlaybackInterval);instance.preloadItems(instance.currentItemIndex);}else{instance.items[instance.currentItemIndex].nextAttempts++;}};instance.prev=function(){var prevItemIndex=instance.currentItemIndex-1;if(prevItemIndex<0){prevItemIndex=instance.items.length-1;};instance.showItem(prevItemIndex,true);instance.preloadItemsPrev(instance.currentItemIndex);};instance.showItem=function(itemIndex,preloadSiblings,doNotClearPlaybackInterval){options.beforeShow(itemIndex);if(instance.items[itemIndex]){if(doNotClearPlaybackInterval!=true&&instance.isPlay==true){instance.play();}
if(instance.items[instance.currentItemIndex]&&instance.items[instance.currentItemIndex].node){instance.items[instance.currentItemIndex].node.css('position','absolute');instance.items[instance.currentItemIndex].node.fadeOut(options.fadeDelay);};instance.currentItemIndex=itemIndex;if(instance.items[instance.currentItemIndex]){if(!instance.items[instance.currentItemIndex].node){instance.addItem(instance.currentItemIndex);};options.beforeAnimation(itemIndex,instance.items[instance.currentItemIndex].node);instance.items[instance.currentItemIndex].node.css('position','relative');instance.items[instance.currentItemIndex].node.fadeIn(options.fadeDelay,options.afterShow());};if(preloadSiblings==true){instance.preloadItems(instance.currentItemIndex);instance.preloadItemsPrev(instance.currentItemIndex);};return true;}else{return false;};};instance.destroy=function(){instance.stop();instance.wrapper.remove();for(var itemIndex=0;itemIndex<instance.items.length;itemIndex++){var item=instance.items[itemIndex];delete item.node;}};instance.stripTags=function(string){if(string!=undefined&&string!=''){string=string.replace(/<\/?[^>]+>/gi,'');return string.replace(/"/gi,"''");}else{return'';}};instance.getOptions=function()
{return options;};{if(new_options.url){new_options.dataSource=new_options.url;}
setOptions(new_options);if(options.dataSource!=false){if(options.dataType=='array'){instance.items=options.dataSource;instance.init();options.afterInit();}else{jQuery.ajax({url:options.dataSource,success:function(data){var items=data.items;if(items.length>0){instance.items=items;instance.init();options.afterInit();};},error:function(jqXHR,textStatus,errorThrown){options.onLoadingError(jqXHR,textStatus,errorThrown);},dataType:options.dataType});}};};return instance;};
function kThumbnailPicker(new_options){kThumbnailPickerVersion='1.1.1';var defaults={wrapper:'#thumbnails-wrapper',dataSource:'data.json',url:undefined,dataType:'json',vertical:false,itemsOnPage:3,preloadPagesCount:2,startItem:0,wrapperClass:'kThumbnailsWrapper',innerWrapperClass:'kThumbnailsInnerWrapper',nextPageClass:'kThumbnailsNextPage',prevPageClass:'kThumbnailsPrevPage',controlsInactiveClass:'inactive',pageClass:'kThumbnailsPage',enableControls:true,scrollingEffect:'slide',scrollingSpeed:1000,afterInit:function(){},beforeShow:function(nextOrPrev){},afterShow:function(nextOrPrev){},thumbnailClick:function(itemIndex){}};var instance={};var options;instance.items=[];instance.currentPageIndex;instance.itemsCount;instance.pagesCount;instance.pages=[];instance.prevPageButton;instance.nextPageButton;instance.wrapper;instance.innerWrapper;function setOptions(new_options){options=jQuery.extend({},defaults,options,new_options);};instance.init=function(){instance.wrapper=jQuery(options.wrapper);instance.wrapper.addClass(options.wrapperClass);instance.innerWrapper=jQuery('<div class="'+options.innerWrapperClass+'"></div>').appendTo(instance.wrapper);instance.itemsCount=instance.items.length;instance.pagesCount=Math.ceil(instance.itemsCount/options.itemsOnPage);if(instance.pagesCount<=1){options.enableControls=false;};if(options.preloadPagesCount>instance.pagesCount){options.preloadPagesCount=instance.pagesCount;};if(options.enableControls==true){instance.initControls();};instance.showItem(options.startItem);instance.preloadPages(instance.currentPageIndex);};instance.initControls=function(){instance.prevPageButton=jQuery('<div class="'+options.prevPageClass+'"></div>').appendTo(instance.wrapper);instance.prevPageButton.click(function(){instance.prev();});instance.nextPageButton=jQuery('<div class="'+options.nextPageClass+'"></div>').appendTo(instance.wrapper);instance.nextPageButton.click(function(){instance.next();});};instance.getPageIndex=function(itemIndex){pageIndex=Math.ceil((itemIndex+1)/options.itemsOnPage)-1;return pageIndex;};instance.preloadPage=function(pageIndex){if(!instance.pages[pageIndex]){instance.pages[pageIndex]=jQuery('<div class="'+options.pageClass+'" style="display: none;"></div>').appendTo(instance.innerWrapper);var firstIndexOnPage=pageIndex*options.itemsOnPage;var lastIndexOnPage=firstIndexOnPage+options.itemsOnPage;for(var itemIndex=firstIndexOnPage;itemIndex<lastIndexOnPage;itemIndex++){if(instance.items[itemIndex]){var item=jQuery('<img/>').attr('src',instance.items[itemIndex].thumb);item.appendTo(instance.pages[pageIndex]);instance.items[itemIndex].thumbnailNode=item;item.bind('click',{itemIndex:itemIndex},function(event){options.thumbnailClick(event.data.itemIndex);});};};};};instance.preloadPages=function(pageIndex){for(var relativePreloadIndex=1;relativePreloadIndex<=options.preloadPagesCount;relativePreloadIndex++){var preloadIndex=instance.currentPageIndex+relativePreloadIndex;if(preloadIndex>=instance.pagesCount){preloadIndex-=instance.pagesCount;};if(!instance.pages[preloadIndex]){instance.preloadPage(preloadIndex);};};};instance.preloadPagesPrev=function(pageIndex){for(var relativePreloadIndex=1;relativePreloadIndex<=options.preloadPagesCount;relativePreloadIndex++){var preloadIndex=instance.currentPageIndex-relativePreloadIndex;if(preloadIndex<0){preloadIndex+=instance.pagesCount;};if(!instance.pages[preloadIndex]){instance.preloadPage(preloadIndex);};};};instance.showPage=function(pageIndex,nextOrPrev){options.beforeShow(nextOrPrev);if(pageIndex>=0&&pageIndex<instance.pagesCount&&pageIndex!=instance.currentPageIndex){if(!instance.pages[pageIndex]){instance.preloadPage(pageIndex);};var scrollingEffect=instance.getScrollingEffect(pageIndex);var currentPageIndex=instance.currentPageIndex;if(instance.pages[currentPageIndex]){instance.pages[currentPageIndex].animate(scrollingEffect.fadeOutEffect,options.scrollingSpeed);};instance.currentPageIndex=pageIndex;instance.pages[pageIndex].css(scrollingEffect.hiddenMap);instance.pages[pageIndex].animate(scrollingEffect.fadeInEffect,options.scrollingSpeed,options.afterShow(nextOrPrev));if(options.enableControls==true){if(instance.currentPageIndex==0){instance.prevPageButton.addClass(options.controlsInactiveClass);instance.nextPageButton.removeClass(options.controlsInactiveClass);}else if(instance.currentPageIndex>=instance.pagesCount-1){instance.nextPageButton.addClass(options.controlsInactiveClass);instance.prevPageButton.removeClass(options.controlsInactiveClass);}else{instance.nextPageButton.removeClass(options.controlsInactiveClass);instance.prevPageButton.removeClass(options.controlsInactiveClass);};};}};instance.getScrollingEffect=function(pageIndex){var scrollingEffect={};switch(options.scrollingEffect){case'slide':if(pageIndex==instance.currentPageIndex+1){if(options.vertical==false){scrollingEffect.fadeOutEffect={left:'-100%'};scrollingEffect.fadeInEffect={left:'0%',opacity:'1'};scrollingEffect.hiddenMap={left:'100%',display:'block'};}else{scrollingEffect.fadeOutEffect={top:'-100%'};scrollingEffect.fadeInEffect={top:'0%',opacity:'1'};scrollingEffect.hiddenMap={top:'100%',display:'block'};}}else if(pageIndex==instance.currentPageIndex-1){if(options.vertical==false){scrollingEffect.fadeOutEffect={left:'100%'};scrollingEffect.fadeInEffect={left:'0%',opacity:'1'};scrollingEffect.hiddenMap={left:'-100%',display:'block'};}else{scrollingEffect.fadeOutEffect={top:'100%'};scrollingEffect.fadeInEffect={top:'0%',opacity:'1'};scrollingEffect.hiddenMap={top:'-100%',display:'block'};}}else{scrollingEffect.fadeOutEffect={opacity:'0'};scrollingEffect.fadeInEffect={opacity:'1',left:'0%',top:'0%'};scrollingEffect.hiddenMap={opacity:'0',left:'0%',top:'0%',display:'block'};};break;case'fade':scrollingEffect.fadeOutEffect={opacity:'0'};scrollingEffect.fadeInEffect={opacity:'1'};scrollingEffect.hiddenMap={opacity:'0',display:'block'};break;default:options.scrollingEffect='slide';scrollingEffect=instance.getScrollingEffect(pageIndex);};return scrollingEffect;};instance.showItem=function(itemIndex){var pageIndex=instance.getPageIndex(itemIndex);instance.showPage(pageIndex);};instance.next=function(){if(instance.currentPageIndex+1<instance.pagesCount){var nextPageIndex=instance.currentPageIndex+1;instance.showPage(nextPageIndex,true);instance.preloadPages(instance.currentPageIndex);};};instance.prev=function(){if(instance.currentPageIndex-1>=0){var prevPageIndex=instance.currentPageIndex-1;instance.showPage(prevPageIndex,true);instance.preloadPagesPrev(instance.currentPageIndex);};};instance.destroy=function(){instance.wrapper.remove();};{if(new_options.url){new_options.dataSource=new_options.url;}
setOptions(new_options);if(options.dataSource!=false){if(options.dataType=='array'){instance.items=options.dataSource;instance.init();options.afterInit();}else{jQuery.ajax({url:options.dataSource,success:function(data){var items=data.items;if(items.length>0){instance.items=items;instance.init();options.afterInit();};},dataType:options.dataType});}};};return instance;};
function kGallery(new_options){window.kGalleryVersion='1.1.1';var defaults={wrapper:'#gallery-wrapper',dataSource:'data.json',url:undefined,dataType:'json',startItem:0,slideshowOptions:{},thumbnailPickerOptions:{},wrapperClass:'kGallery',selectedThumbnailClass:'selectedThumbnail',afterInit:function(){},beforeShow:function(itemIndex){}};var instance={};var options;instance.index=null;instance.items=[];instance.wrapper;instance.slideshow;instance.thumbnailsPicker;instance.lastThumbnail;function setOptions(new_options){options=jQuery.extend({},defaults,options,new_options);};instance.init=function(){instance.wrapper=jQuery(options.wrapper);var prevInstance=instance.wrapper.data('kGalleryInstance');if(prevInstance){prevInstance.destroy();}
instance.wrapper.addClass(options.wrapperClass);instance.initSlideshow();instance.initThumbnailPicker();instance.wrapper.data('kGalleryInstance',instance);};instance.destroy=function(){};instance.initThumbnailPicker=function(){var thumbnailPickerDefaults={dataSource:false,startItem:options.startItem};if(!options.thumbnailPickerOptions.wrapper){thumbnailPickerDefaults.wrapper=jQuery('<div></div>').appendTo(instance.wrapper);};thumbnailPickerDefaults.thumbnailClick=function(itemIndex){if(instance.slideshow&&itemIndex!=instance.slideshow.currentItemIndex){instance.slideshow.showItem(itemIndex);};};thumbnailPickerDefaults.beforeShow=function(nextOrPrev){if(instance.slideshow.isPlay==true){instance.slideshow.play();}};var thumbnailPickerOptions=jQuery.extend({},thumbnailPickerDefaults,options.thumbnailPickerOptions);instance.thumbnailPicker=kThumbnailPicker(thumbnailPickerOptions);instance.thumbnailPicker.items=instance.items;instance.thumbnailPicker.init();if(instance.thumbnailPicker.items[options.startItem]&&instance.thumbnailPicker.items[options.startItem].thumbnailNode){instance.lastThumbnail=instance.thumbnailPicker.items[options.startItem].thumbnailNode;instance.lastThumbnail.addClass(options.selectedThumbnailClass);};};instance.initSlideshow=function(){var slideshowDefaults={dataSource:false,startItem:options.startItem};if(!options.slideshowOptions.wrapper){slideshowDefaults.wrapper=jQuery('<div></div>').appendTo(instance.wrapper)};slideshowDefaults.beforeShow=function(itemIndex){options.beforeShow(itemIndex);if(instance.thumbnailPicker){if(instance.thumbnailPicker.items[itemIndex].thumbnailNode){instance.thumbnailPicker.items[itemIndex].thumbnailNode.addClass(options.selectedThumbnailClass);instance.lastThumbnail.removeClass(options.selectedThumbnailClass);instance.lastThumbnail=instance.thumbnailPicker.items[itemIndex].thumbnailNode;};};};slideshowDefaults.afterShow=function(){if(instance.thumbnailPicker){instance.thumbnailPicker.showItem(instance.slideshow.currentItemIndex);};};var slideshowOptions=jQuery.extend({},slideshowDefaults,options.slideshowOptions);instance.slideshow=kSlideshow(slideshowOptions);instance.slideshow.items=instance.items;instance.slideshow.init();};instance.destroy=function(){instance.slideshow.destroy();instance.thumbnailPicker.destroy();};{if(typeof new_options==='string'||new_options instanceof jQuery||(typeof new_options==='object'&&new_options.nodeType)){var prevInstance=jQuery(new_options).data('kGalleryInstance');if(prevInstance){return prevInstance;}}
if(new_options.url){new_options.dataSource=new_options.url;}
if(typeof new_options!=='object'||!new_options.dataSource){return false;}
setOptions(new_options);if(options.dataType=='array'){instance.items=options.dataSource;instance.init();options.afterInit();}else{jQuery.ajax({url:options.dataSource,success:function(data){var items=data.items;instance.items=items;instance.init();options.afterInit();},dataType:options.dataType});}};return instance;};jQuery.fn.kGallery=function(urlOrOptions){var options={};if(typeof urlOrOptions==='string'){options.url=urlOrOptions;options.wrapper=jQuery(this);}else if(typeof urlOrOptions==='object'){options=urlOrOptions;options.wrapper=jQuery(this);}else if(typeof urlOrOptions==='undefined'){options=$(this);}
return kGallery(options);};